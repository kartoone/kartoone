<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Table</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            cursor: pointer; /* Indicate that the table headers are clickable */
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        th.sorted-asc {
            background-color: #d1e7dd; /* Light green for ascending sort */
        }
        th.sorted-desc {
            background-color: #f8d7da; /* Light red for descending sort */
        }
    </style>
</head>
<body>

<table id="data-table">
    <thead>
        <tr>
            <th onclick="sortTable(0)">ID</th>
            <th onclick="sortTable(1)">Speed</th>
            <th onclick="sortTable(2)">Result</th>
            <th onclick="sortTable(3)">Datetime</th>
        </tr>
    </thead>
    <tbody>
        <!-- Data will be populated here -->
    </tbody>
</table>

<script>
    let tableData = [];
    let currentSortColumn = null; // Track the current sorted column
    let currentSortOrder = 'asc';  // Track the sort order

    async function fetchData() {
        try {
            const response = await fetch('https://compute.samford.edu/zohauth/clients/datajson');
            const data = await response.json();
            tableData = data; // Store data for sorting

            populateTable(data);
        } catch (error) {
            console.error('Error fetching data:', error);
        }
    }

    function populateTable(data) {
        const tableBody = document.getElementById('data-table').getElementsByTagName('tbody')[0];
        tableBody.innerHTML = ''; // Clear any existing rows

        data.forEach(item => {
            const row = document.createElement('tr');

            const idCell = document.createElement('td');
            idCell.innerHTML = `<a href="details.html?id=${item.id}">Pitch ${item.id}</a>`;
            row.appendChild(idCell);

            const speedCell = document.createElement('td');
            speedCell.textContent = item.speed || '--';
            row.appendChild(speedCell);

            const resultCell = document.createElement('td');
            resultCell.textContent = item.result || '--';
            row.appendChild(resultCell);

            const datetimeCell = document.createElement('td');
            datetimeCell.textContent = item.datetime || '--';
            row.appendChild(datetimeCell);

            tableBody.appendChild(row);
        });
    }

    function sortTable(columnIndex) {
        const sortedData = [...tableData]; // Create a copy of the original data

        // Determine sort order
        if (currentSortColumn === columnIndex) {
            currentSortOrder = currentSortOrder === 'asc' ? 'desc' : 'asc';
        } else {
            currentSortOrder = 'asc'; // Default to ascending sort
        }

        // Sort the data
        sortedData.sort((a, b) => {
            let aValue, bValue;

            if (columnIndex === 0) { // ID column
                aValue = a.id;
                bValue = b.id;
            } else if (columnIndex === 1) { // Speed column
                aValue = a.speed;
                bValue = b.speed;
            } else if (columnIndex === 2) { // Result column
                aValue = a.result;
                bValue = b.result;
            } else if (columnIndex === 3) { // Datetime column
                aValue = new Date(a.datetime);
                bValue = new Date(b.datetime);
            }

            return currentSortOrder === 'asc' ? (aValue < bValue ? -1 : (aValue > bValue ? 1 : 0)) : (aValue > bValue ? -1 : (aValue < bValue ? 1 : 0));
        });

        // Populate the table with sorted data
        populateTable(sortedData);
        
        // Update sorted column indication
        updateSortIndicator(columnIndex);
    }

    function updateSortIndicator(columnIndex) {
        const headers = document.querySelectorAll('#data-table th');
        
        // Clear previous sort indicators
        headers.forEach((header, index) => {
            header.classList.remove('sorted-asc', 'sorted-desc');
            if (index === columnIndex) {
                header.classList.add(currentSortOrder === 'asc' ? 'sorted-asc' : 'sorted-desc');
            }
        });

        // Update the current sorted column
        currentSortColumn = columnIndex;
    }

    // Fetch data when the page loads
    window.onload = fetchData;
</script>

</body>
</html>
